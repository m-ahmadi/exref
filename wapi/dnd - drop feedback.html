<style>
div[draggable=true] {
	width: 20px; height: 20px;
	background: red;
}

.dropzone {
	width: 150px;
	height: 150px;
	border: 1px dashed grey;
	margin: 1em 4em;
}

p { background: dodgerblue; }

.dragging { background: green !important; }
</style>

<div class="draggable"></div>

<div class="dropzone">
	<p>foo</p>
	<p>bar</p>
</div>

<div class="dropzone">
	<p>hello</p>
	<p>world</p>
</div>


<script>
log = console.log;
$ = (selector, ctx=document) => [...ctx.querySelectorAll(selector)];

$('.draggable').forEach(draggable);
$('.dropzone').forEach(droppable);

function draggable(el) {
	var n = 0;
	if (!el.id) el.setAttribute('id', '_dnd'+(n++));
	el.setAttribute('draggable', true);
	el.ondragstart = dragstart;
	
	function dragstart(e) {
		this.classList.add('dragging');
		e.dataTransfer.effectAllowed = 'move';
		e.dataTransfer.dropEffect = 'move';
		e.dataTransfer.setData('text/plain', e.target.id);
	}
}

function droppable(el) {
	el.ondragenter = dragenter;
	el.ondragleave = dragleave;
	el.ondragover = dragover;
	el.ondrop = drop;
	
	function dragenter(e) {
		e.target.style.border = '2px dashed dodgerblue';
	}
	function dragleave(e) {
		e.target.style.border = '';
	}
	function dragover(e) {
		e.preventDefault();
		
		const dragging = document.querySelector('.dragging');
		
		const box = this.getBoundingClientRect();
		
		const dragX = e.clientX - box.x;
		const dragY = e.clientY - box.y;
		
		const directChildren = this.querySelectorAll(':scope > *');
		let draggedOver;
		for (el of directChildren) {
			const { x, y, width, height } = el.getBoundingClientRect();
			const { clientX: cX, clientY: cY } = e;
			if ((cX > x && cX < x+width) && (cY > y && cY < y+height)) {
				draggedOver = el;
			}
		}
		if (draggedOver) {
			draggedOver.before(dragging);
		} else {
			//this.append(dragging);
		}
		//log(e.clientX, e.clientY);
		//log(draggedOver);
	}

	function drop(e) {
		e.preventDefault();
		var id = e.dataTransfer.getData('text/plain');
		var el = document.getElementById(id);
		el.classList.remove('dragging');
		e.target.append(el);
	}
}

function getElementsFromRect(selector, x1, y1, x2, y2, ctx=document) {
	const res = [];
	ctx.querySelectorAll(selector).forEach(el => {
		const { x, y, width, height } = el.getBoundingClientRect();
		if (x >= x1 && y >= y1 && x+width <= x2 && y+height <= y2) {
			res.push(el);
		}
	});
	return res;
}
</script>