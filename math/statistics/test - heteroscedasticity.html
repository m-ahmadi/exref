<script src="fn.js"></script>
<script src="fn-hetWhite.js"></script>
<script>
log=console.log;

log(`
the white test checks if the residuals (errors) have constant variance.

how to perform the test:
	1. fit linear regression
	2. subtract y from linear regression line (residuals)
	3. no need to add a constant 1 to x like x_with_const in py
	4. feed x and residuals to the heWhite() fn



how to interpret the results

H₀ = homoscedasticity
H₁ = heteroscedasticity

`);

//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// x,y from py
sumErr = (a,b) => sum(a.map((v,i) => Math.abs(v-b[i])));
`
np.random.seed(42)
x = np.linspace(0, 100, 100)
y = 2*x+5 + np.random.normal(0,10,100) * (x/20) # intentional heteroscedasticity
`
x = [0.0, 1.0101010101010102, 2.0202020202020203, 3.0303030303030303, 4.040404040404041, 5.050505050505051, 6.0606060606060606, 7.070707070707071, 8.080808080808081, 9.090909090909092, 10.101010101010102, 11.111111111111112, 12.121212121212121, 13.131313131313131, 14.141414141414142, 15.151515151515152, 16.161616161616163, 17.171717171717173, 18.181818181818183, 19.191919191919194, 20.202020202020204, 21.212121212121215, 22.222222222222225, 23.232323232323235, 24.242424242424242, 25.252525252525253, 26.262626262626263, 27.272727272727273, 28.282828282828284, 29.292929292929294, 30.303030303030305, 31.313131313131315, 32.323232323232325, 33.333333333333336, 34.343434343434346, 35.35353535353536, 36.36363636363637, 37.37373737373738, 38.38383838383839, 39.3939393939394, 40.40404040404041, 41.41414141414142, 42.42424242424243, 43.43434343434344, 44.44444444444445, 45.45454545454546, 46.46464646464647, 47.47474747474748, 48.484848484848484, 49.494949494949495, 50.505050505050505, 51.515151515151516, 52.525252525252526, 53.535353535353536, 54.54545454545455, 55.55555555555556, 56.56565656565657, 57.57575757575758, 58.58585858585859, 59.5959595959596, 60.60606060606061, 61.61616161616162, 62.62626262626263, 63.63636363636364, 64.64646464646465, 65.65656565656566, 66.66666666666667, 67.67676767676768, 68.68686868686869, 69.6969696969697, 70.70707070707071, 71.71717171717172, 72.72727272727273, 73.73737373737374, 74.74747474747475, 75.75757575757576, 76.76767676767678, 77.77777777777779, 78.7878787878788, 79.7979797979798, 80.80808080808082, 81.81818181818183, 82.82828282828284, 83.83838383838385, 84.84848484848486, 85.85858585858587, 86.86868686868688, 87.87878787878789, 88.8888888888889, 89.89898989898991, 90.90909090909092, 91.91919191919193, 92.92929292929294, 93.93939393939395, 94.94949494949496, 95.95959595959597, 96.96969696969697, 97.97979797979798, 98.98989898989899, 100.0];
y = [5.0, 6.950371565065058, 9.694634886970398, 13.368227055163675, 12.607770960154877, 14.509755159219242, 21.90670550153755, 21.85456722427796, 19.264749955818377, 25.648000198118023, 22.861526803977466, 24.634834702387465, 30.70886225191536, 18.70068526234779, 21.086439568089666, 31.043276293628995, 29.138738421540012, 42.04151750208064, 33.108872040716264, 29.83142912860074, 60.20857342345005, 45.02964529787008, 50.19475782986583, 34.91454127125783, 46.886270005755364, 56.90558825391245, 42.41119544798997, 64.66860934107734, 53.07177610215832, 59.313576391916655, 56.489293754100046, 96.62657763625106, 69.4283276810031, 54.038151184068326, 87.81137727853961, 54.12650113687587, 81.5247926364501, 43.12737647295369, 56.27723744538366, 87.66544858530092, 100.72659757566487, 91.37681794383273, 87.39533946449188, 85.32956620689929, 61.032844658501624, 79.54899526375664, 87.22758410901505, 125.04280031933791, 110.2998373228718, 60.35910726627577, 114.1940396311817, 98.11151701957972, 92.27275554752028, 128.4438602568515, 142.20907788625323, 141.9800033087833, 94.3958680300668, 111.24994675579838, 131.8753934451549, 153.2611931819289, 111.69168976226395, 122.51252647651877, 95.60971293516478, 94.21160741561502, 160.55639021880236, 180.83616255409268, 135.9329959473222, 174.31146674685132, 154.79356045618138, 121.91249340012446, 159.19075373009545, 203.586159706608, 149.15178039600178, 210.16110448203156, 56.58528398856511, 187.64782213542514, 161.87655413439447, 148.92749192632738, 166.190576045338, 85.29396754875226, 157.74052978434298, 183.24551428911693, 231.86227862060827, 150.9512989309532, 140.39724108937992, 155.17709661379516, 218.4972636981709, 195.20270027292554, 159.2328798325761, 207.86909169044887, 191.23079769763822, 233.3569162315621, 158.23793705216343, 177.4885961446503, 176.28375434625113, 126.70004036739837, 213.29674070616127, 213.74866737446933, 203.2328882580612, 193.27064333124267];
resid_orig = [2.3838409000950147, 2.306454729160185, 3.022960315065636, 4.6687947472590245, 1.880580916250338, 1.7548073793148156, 7.123999985633237, 5.044103972373758, 0.4265289679142832, 4.782021474214044, -0.03220965592640468, -0.2866594935162965, 3.7596103200117135, -10.27632440555574, -9.918327835813756, -1.989248846274318, -5.921544454363186, 4.953476890177548, -6.00692630718671, -11.312126955302126, 17.037259603547298, -0.1694262580325585, 2.967928537963296, -14.340045756644585, -4.396074758146938, 3.595485754010255, -12.92666478791211, 7.302991369175373, -6.321599605743536, -2.10755705198509, -6.95959742580159, 31.149928720349536, 1.9239210291016775, -15.494013203832978, 16.251455154638407, -19.461178723025213, 5.90935504054913, -34.51581885894718, -23.393715622517092, 5.966737781400283, 17.000129035764346, 5.622591667932312, -0.386644547408423, -4.480175541000904, -30.804654825398465, -14.316261956143336, -8.665430846884803, 27.122027627438158, 10.351306894972168, -41.61718089762374, 10.189993731282286, -7.920286616319572, -15.786805824378902, 18.35654114895243, 30.094001042354265, 27.83716872888445, -21.774724285831937, -6.948403296100253, 11.6492856572564, 31.00732765803049, -12.589933497634348, -3.7968545193794085, -32.72742579673327, -36.15328905228293, 28.163736014904515, 46.415750614194934, -0.5151737285754052, 35.83553933495381, 14.289875308283968, -20.618949483772823, 14.631553110198269, 56.999201350710905, 0.5370643041048311, 59.51863065413471, -96.08494757533164, 32.949832835528525, 5.15080709849795, -9.82601284556904, 5.4093135374417045, -77.51505269514392, -7.096248195553073, 16.380978573220972, 62.96998516871241, -19.968752256942537, -32.550567834515704, -19.798470046100363, 41.49393930227552, 16.17161814103025, -21.8259600353191, 24.78249408655381, 6.116442357743267, 46.214803155667255, -30.931933759731294, -13.709032403244322, -16.941631937643393, -68.55310365249602, 16.01583895026701, 14.440007882575173, 1.896471030167163, -10.093531632651263];


regline = regressionLinear(x,y);
resid = y.map((v,i) => v - regline[i]);
sumErr(resid, resid_orig); // 5.047517959155812e-12

xMat = x.map(i => [i]);
res = hetWhite(resid, xMat);

h0_rejected = res['Test Statistic p-value'] < 0.05;
log(res);
log('series is', h0_rejected ? 'heteroscedastic' : 'homoscedastic');

//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// js replica of py example generated x,y

x = range(1,101);
nrm = randomNormal(0,10,100);
y = range(100).map((v,i)=> 2*x[i]+5 + nrm[i] * (x[i]/20) );

regline = regressionLinear(x,y);
resid = y.map((v,i) => v - regline[i]);

xMat = x.map(i => [i]);
res = hetWhite(resid, xMat);

h0_rejected = res['Test Statistic p-value'] < 0.05;
log(res);
log('series is', h0_rejected ? 'heteroscedastic' : 'homoscedastic');

//@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

</script>
